<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Galaxy Explorer through Sahil's Universe
    </title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #000; 
        }


        
        /* Hide the original three.js header*/
        iframe { 
            width: 100%; 
            height: 100vh;
            border: none; 
            display: block; 
        }
        /* Back button */
        .back-btn { 
            position: fixed; 
            top: 20px; 
            left: 20px; 
            z-index: 10000;
            background: rgba(0,0,0,0.9); 
            border: 2px solid #00fff5;
            color: #00fff5; 
            padding: 12px 40px; 
            border-radius: 8px;
            cursor: pointer; 
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-family: 600;
            text-decoration: none; 
            display: flex;
            align-items: center; 
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0,255,245,0.3);
        }
        .back-btn:hover { 
            background: rgba(0,255,245,0.2); 
            transform: translateX(-3px);
            box-shadow: 0 0 50px rgba(0,255,245,0.5);
        }

        /* Story overlay with scroll effect*/
        /* .story-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-height: 50vh;
            z-index: 10000;
            background: linear-gradient(to top,
            rgba(0, 0, 0, 0.95), 
            rgba(0, 0, 0, 0.7), 
            transparent 100%);
            padding: 40px 60px 120px 60px;
            pointer-events: none;
            overflow: hidden;
        } */
        .story-overlay {
            position: fixed;
            bottom: 120px;
            left: 50px;
            z-index: 10000;
            pointer-events: none;
        }



        .story-container {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .story-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 16px;
            line-height: 1.2;
            color: #00ff00;
            font-weight: 50;
            /* The "Glow" effect */
            text-shadow: 0 0 100px rgba(255, 255, 255, 0.9);
            /* text-shadow: 0px 0px 8px rgba(0, 255, 0, 0.8);  */
            letter-spacing: 2px;
        }

        .story-line {
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(0, 255, 245, 0.6),
                0 0 30px rgba(0, 255, 245, 0.4);
            opacity: 1;
            transform: translateY(0);
            transition: all 2s ease-out;
        }

        /* .story-line.fade-up {
            opacity: 0;
            transform: translateY(-50px);
        } */
        .story-line.fade-away {
            opacity: 0;
            transform: translateY(-50px);
        }

        .story-line.permanent {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        .cursor {
            display: inline-block;
            width: 3px;
            height: 24px;
            background: #ffffff;
            margin-left: 2px;
            animation: blink 0.8s infinite;
            box-shadow: 
                0 0 5px rgba(255, 255, 245, 1),
                0 0 10px rgba(0, 255, 245, 0.8);
            vertical-align: middle;
        }
        
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        
    .start-hint {
        position: fixed;
        /*top: 330px; /*120px to move down*/
        top: 50vh; /* closer to the galaxy band*/
        
        /*left: 400px; /* 40px adjust from left towards right*/
        left: 18vw; /*move more towards the centre so 39vw to center better on different screens*/
        
        z-index: 10000;
        font-family: 'Orbitron', sans-serif;
        font-size: 16px;
        color: #ffffff;
        opacity: 0.95;
        cursor: pointer;
        user-select: none;
        transition: opacity 0.5s ease;
        /* text-shadow: 0 0 10px rgba(0,255,245,0.8); */
        text-shadow:
            0 0 12px rgba(0, 255, 195, 0.9),
            0 0 25px rgba(0,255,245,0.6);
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .hint-arrow {
        filter:
        drop-shadow(0 0 10px rgba(255,255,255,0.9))
        drop-shadow(0 0 20px rgba(0,255,245,0.7)); 
    }
    
    .start-hint .arrow {
        animation: bounce 1.2s infinite;
    }

    @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(4px); }
    }

    .start-hint.fade-out {
    opacity: 0;
    pointer-events: none;
    }

    .click-catcher {
    position: fixed;
    inset: 0;
    z-index: 9000;
    background: transparent;
    }

        
        /* @keyframes fadeIn {
            to { opacity: 1; }
        } */

    </style>
</head>

<body>

    <!-- Start hint with arrow in the Galaxy
    <div class="start-hint">Sahil's Universe <span class="arrow">&rarr;</span></div> -->
    
    <div class="click-catcher"></div>

    <!-- Curve point hint with arrow in the Galaxy-->
    <div class="start-hint">
        Sahil's Universe
        <svg class="hint-arrow" width="220" height="60" viewBox="0 0 220 60">
            <defs>
                <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                    <!-- thinner, sharper triangle -->
                    <polygon points="0 1, 7 4, 0 7" fill="#ffffff"/>
                </marker>
            </defs>
    
            <!-- thin, subtle, glowing curve -->
            <path d="M-10,33 Q190,10 210,33"
                  stroke="#ffffff"
                  stroke-width="0.8"
                  stroke-linecap="round"
                  stroke-opacity="0.4"
                  fill="none"
                  marker-end="url(#arrowhead)" 
            />
        </svg>
    </div>

    <!-- Galaxy iframe -->
    <iframe src="../three.js/examples/webgpu_tsl_galaxy.html"></iframe>

    <!-- Story Overlay -->
    <div class="story-overlay">
        <div class="story-text" id="story-text"></div>
    </div>

    <!-- Back button -->
    <a href="../index.html" class="back-btn">
        <span>&larr;</span>
        <span>Back to Sahil's Universe</span>
    </a>


    <!-- Keyboard sound (using Web Audio API beep) -->
    <script>
        const story = [
            ">>> TRANSMISSION RECEIVED <<<",
            "You have departed from your origin point...",
            "SAHIL'S UNIVERSE.",
            "Welcome, traveler, to the INFINITE GALAXY.",
            
            "A galaxy much like SAHIL'S UNIVERSE exists here.",
            "But the question remains, traveler...",
            "Would you like to CREATE YOUR OWN UNIVERSE?",
            "The choice... is yours."
        ];

        const permanentLines = [
            "Would you like to CREATE YOUR OWN UNIVERSE?",
            "The choice... is yours."
        ];

        const storyContainer = document.getElementById('story-text');
        let currentLine = 0;
        let currentChar = 0;
        
        // const maxVisibleLines = 8;
        
        // Audio setup
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let ambientOscillator = null;
        let ambientGain = null;

        function startAmbientSound() {
            ambientOscillator = audioContext.createOscillator();
            ambientGain = audioContext.createGain();
            
            ambientOscillator.connect(ambientGain);
            ambientGain.connect(audioContext.destination);
            
            ambientOscillator.frequency.value = 455; // Deep space hum
            ambientOscillator.type = 'triangle'; // 'sine', 'triangle', 'sawtooth', 'square'
            
            ambientGain.gain.setValueAtTime(0, audioContext.currentTime);
            ambientGain.gain.linearRampToValueAtTime(0.025, audioContext.currentTime + 2);
            
            ambientOscillator.start();
        }

        // Generated text Key sound effect like Typing
        function playKeySound() {
        const now = audioContext.currentTime;

        // ---- 1) Deep mechanical thump ----
        const osc = audioContext.createOscillator();
        const thumpGain = audioContext.createGain();

        osc.type = 'square'; // beefy
        osc.frequency.setValueAtTime(10 + Math.random() * 40, now); // low, heavy

        thumpGain.gain.setValueAtTime(0.0, now);
        thumpGain.gain.linearRampToValueAtTime(0.65, now + 0.01);      // fast attack
        thumpGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12); // short decay

        osc.connect(thumpGain);
        thumpGain.connect(audioContext.destination);

        osc.start(now);
        osc.stop(now + 0.15);

        // ---- 2) Short mechanical click on top (very subtle) ----
        const noiseDuration = 0.04;
        const noiseBuffer = audioContext.createBuffer(1, noiseDuration * audioContext.sampleRate, audioContext.sampleRate);
        const data = noiseBuffer.getChannelData(0);
        for (let i = 0; i < data.length; i++) {
            data[i] = (Math.random() * 2 - 1) * 0.6;
        }

        const noise = audioContext.createBufferSource();
        noise.buffer = noiseBuffer;

        const bp = audioContext.createBiquadFilter();
        bp.type = 'bandpass';
        bp.frequency.value = 5000;
        bp.Q.value = 3;

        const clickGain = audioContext.createGain();
        clickGain.gain.setValueAtTime(0.12, now);
        clickGain.gain.exponentialRampToValueAtTime(0.001, now + noiseDuration);

        noise.connect(bp);
        bp.connect(clickGain);
        clickGain.connect(audioContext.destination);

        noise.start(now);
        noise.stop(now + noiseDuration);
    }

        // Start noise sound effect at the beginning of typing (Not good)
        function playStartNoise() {
            const duration = 0.5; // 250ms
            const sampleRate = audioContext.sampleRate;

            const buffer = audioContext.createBuffer(1, sampleRate * duration, sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < data.length; i++) {
                // white noise, slightly tamed
                data[i] = (Math.random() * 2 - 1) * 0.4;
            }

            const noise = audioContext.createBufferSource();
            const gain = audioContext.createGain();

            noise.buffer = buffer;
            noise.connect(gain);
            gain.connect(audioContext.destination);

            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            noise.start();
        }

        function fadeOldLines() {
            const lines = storyContainer.querySelectorAll('.story-line');
            if (lines.length > maxVisibleLines) {
                // Fade out oldest line
                lines[0].classList.add('fade-up');
                setTimeout(() => {
                    lines[0].remove();
                }, 1500);
            }
        }


        function typeWriter() {
            if (currentLine >= story.length) {
                return;
            }

            const line = story[currentLine];
            const isPermanent = permanentLines.includes(line);
            
            if (currentChar === 0) {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'story-line' + (isPermanent ? ' permanent' : '');
                lineDiv.id = `line-${currentLine}`;
                storyContainer.appendChild(lineDiv);
            }
            
            const lineDiv = document.getElementById(`line-${currentLine}`);

            // if (currentChar < line.length) {
            //     const char = line[currentChar];
                
            //     // Remove cursor
            //     const cursor = lineDiv.querySelector('.cursor');
            //     if (cursor) cursor.remove();
                
            //     // Add character
            //     lineDiv.appendChild(document.createTextNode(char));
                
            //     // Add cursor
            //     const newCursor = document.createElement('span');
            //     newCursor.className = 'cursor';
            //     lineDiv.appendChild(newCursor);
                
            //     if (char !== ' ' && char !== '.') {
            //         playKeySound();
            //     }
            if (currentChar < line.length) {
                const char = line[currentChar];

                const cursor = lineDiv.querySelector('.cursor');
                if (cursor) cursor.remove();

                lineDiv.appendChild(document.createTextNode(char));

                const newCursor = document.createElement('span');
                newCursor.className = 'cursor';
                lineDiv.appendChild(newCursor);

                if (char !== ' ' && char !== '.') {
                    playKeySound();
                }      
                /////////////////////////

                currentChar++;
                
                // const speed = line === '...' ? 800 : (100 + Math.random() * 50);
                const speed = line === '...' ? 800 : (100 + Math.random() * 50);
                setTimeout(typeWriter, speed);
            } 
            else {
                // Remove cursor after line finishes
                const cursor = lineDiv.querySelector('.cursor');
                if (cursor) cursor.remove();
                
                // Fade away non-permanent lines after 3 seconds
                if (!isPermanent) {
                    setTimeout(() => {
                        lineDiv.classList.add('fade-away');
                        setTimeout(() => lineDiv.remove(), 2000);
                    }, 1000); // Delay before starting fade
                }
                
                currentLine++;
                currentChar = 0;
                
                const pause = 2000 + Math.random() * 1000;
                setTimeout(typeWriter, pause);
            }
        }

        let universeSoundStarted = false;

        function startHumIfNeeded() {
            if (!universeSoundStarted) {
            audioContext.resume();
            startAmbientSound();
            universeSoundStarted = true;

            // remove the click catcher so iframe becomes clickable again
            document.querySelector('.click-catcher').remove();
            }
        }

        document.querySelector('.click-catcher').addEventListener('click', startHumIfNeeded);


        // click on "Sahil's Universe downarrow" start text
        const startHint = document.querySelector('.start-hint');

        startHint.addEventListener('click', () => {
            playStartNoise(); // radio noise
            setTimeout(typeWriter, 1000); // start txt right after noise
            startHint.classList.add('fade-out'); // hide the hint
        });


    
    </script>

            
            <!-- if (currentChar < line.length) {
                // Type character
                const char = line[currentChar];

                // Remove cursor
                const cursor = lineDiv.querySelector('.cursor');
                if (cursor) cursor.remove();

                // Add character
                const textNode = document.createTextNode(char);
                lineDiv.appendChild(textNode);
                
                // Add cursor back
                const newCursor = document.createElement('span');
                newCursor.className = 'cursor';
                lineDiv.appendChild(newCursor);
                
                // Play sound for non-space characters
                if (char !== ' ' && char !== '.') {
                    playKeySound();
                }

                currentChar++;

                // Slower, more dramatic speed (100-150ms per character)
                const speed = line === '...' ? 800 : (100 + Math.random() * 50);
                setTimeout(typeWriter, speed);
            } else {
                // Line finished
                currentLine++;
                currentChar = 0;
                
                // Longer pause between lines (2-3 seconds)
                const pause = 2000 + Math.random() * 1000;
                setTimeout(typeWriter, pause);
            }
        }
        
        // Start typing after 2 seconds
        setTimeout(() => {
            startAmbientSound();
            setTimeout(typeWriter, 1000);
        }, 2000);
    </script>
     -->
</body>
</html>