<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Galaxy Explorer through Sahil's Universe
    </title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        /* Hide the original three.js header*/
        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
        }

        /* Back button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00fff5;
            color: #00fff5;
            padding: 12px 40px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-family: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 245, 0.3);
        }

        .back-btn:hover {
            background: rgba(0, 255, 245, 0.2);
            transform: translateX(-3px);
            box-shadow: 0 0 50px rgba(0, 255, 245, 0.5);
        }

        .story-overlay {
            position: fixed;
            bottom: 120px;
            left: 50px;
            z-index: 10000;
            pointer-events: none;
        }

        .story-overlay a {
            pointer-events: auto;
        }

        .story-container {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        .story-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 16px;
            line-height: 1.2;
            color: #00ff00;
            font-weight: 50;
            /* The "Glow" effect */
            text-shadow: 0 0 100px rgba(255, 255, 255, 0.9);
            /* text-shadow: 0px 0px 8px rgba(0, 255, 0, 0.8);  */
            letter-spacing: 2px;
        }

        .story-line {
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow:
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(0, 255, 245, 0.6),
                0 0 30px rgba(0, 255, 245, 0.4);
            opacity: 1;
            transform: translateY(0);
            transition: all 2s ease-out;
        }

        .story-line.fade-away {
            opacity: 0;
            transform: translateY(-50px);
        }

        .story-line.permanent {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        .cursor {
            display: inline-block;
            width: 3px;
            height: 24px;
            background: #ffffff;
            margin-left: 2px;
            animation: blink 0.8s infinite;
            box-shadow:
                0 0 5px rgba(255, 255, 245, 1),
                0 0 10px rgba(0, 255, 245, 0.8);
            vertical-align: middle;
        }

        @keyframes blink {

            0%,
            49% {
                opacity: 1;
            }

            50%,
            100% {
                opacity: 0;
            }
        }


        .start-hint {
            position: absolute;
            top: 50vh;
            /* closer to the center*/
            left: 18vw;
            /*move more towards the centre so 39vw to center better on different screens*/

            z-index: 10000;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2vw;
            color: #ffffff;
            opacity: 0.95;
            cursor: pointer;
            user-select: none;
            /* transition: font-size 120ms ease; */
            /* text-shadow: 0 0 10px rgba(0,255,245,0.8); */
            text-shadow:
                0 0 12px rgba(0, 255, 195, 0.9),
                0 0 25px rgba(0, 255, 245, 0.6);
            display: flex;
            align-items: center;
            gap: 0.6vw;
            transform-origin: left center;
        }

        .hint-arrow {
            filter:
                drop-shadow(0 0 10px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 20px rgba(0, 255, 245, 0.7));
        }

        .start-hint .arrow {
            animation: bounce 1.2s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(4px);
            }
        }

        .start-hint.fade-out {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .click-catcher {
            position: fixed;
            inset: 0;
            z-index: 9000;
            background: transparent;
        }

        #warp-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            pointer-events: none;
            background: radial-gradient(ellipse at center,
                    rgba(0, 0, 0, 0) 0%,
                    rgba(0, 0, 0, 0.2) 40%,
                    rgba(0, 0, 0, 0.6) 70%,
                    rgba(0, 0, 0, 0.9) 100%);
        }

        #warp-overlay.active {
            display: flex;
            pointer-events: none;
            animation: overlay-fade-in 0.25s linear;
        }

        /* core glowing ring that scales */
        .warp-core {
            width: 28vmin;
            height: 28vmin;
            border-radius: 50%;
            background: conic-gradient(from 120deg,
                    rgba(0, 255, 245, 0.06),
                    rgba(0, 255, 245, 0.18),
                    rgba(255, 255, 255, 0.02),
                    rgba(0, 255, 245, 0.12));
            box-shadow:
                0 0 40px rgba(0, 255, 245, 0.08),
                0 0 120px rgba(0, 255, 245, 0.06),
                inset 0 0 24px rgba(255, 255, 255, 0.02);
            transform: scale(0.6);
            filter: blur(6px);
            opacity: 0.95;
            animation: warp-core-scale var(--warp-ms, 2000ms) cubic-bezier(.2, .9, .3, 1) forwards;
        }

        /* fast streaks (gives speed-of-light feel) */
        .warp-streaks {
            position: absolute;
            inset: -20%;
            background-image:
                linear-gradient(90deg, rgba(255, 255, 255, 0.0) 0%, rgba(255, 255, 255, 0.12) 50%, rgba(255, 255, 255, 0.0) 100%);
            background-size: 200% 2px;
            transform: translateZ(0);
            mix-blend-mode: screen;
            opacity: 0.0;
            animation: streaks-move var(--warp-ms, 2000ms) linear forwards;
            filter: blur(2px) contrast(1.2);
        }

        /* keyframes */
        @keyframes warp-core-scale {
            0% {
                transform: scale(0.6) rotate(0deg);
                filter: blur(8px);
                opacity: 0.8;
            }

            40% {
                transform: scale(1.4) rotate(45deg);
                filter: blur(2px);
                opacity: 1;
            }

            100% {
                transform: scale(4.2) rotate(170deg);
                filter: blur(12px);
                opacity: 0;
            }
        }

        @keyframes streaks-move {
            0% {
                opacity: 0;
                background-position: 0% 0%;
                transform: translateY(0) scale(1);
            }

            10% {
                opacity: 0.6;
            }

            60% {
                background-position: 100% 0%;
                opacity: 0.95;
                transform: scale(1.2) translateY(-4%);
            }

            100% {
                opacity: 0;
                transform: scale(1.8) translateY(-10%);
            }
        }

        @keyframes overlay-fade-in {
            from {
                background-color: rgba(0, 0, 0, 0);
            }

            to {
                background-color: rgba(0, 0, 0, 0.55);
            }
        }






        /* @keyframes fadeIn {
                to { opacity: 1; }
            } */
    </style>
</head>

<body>

    <!-- Start hint with arrow in the Galaxy
    <div class="start-hint">Sahil's Universe <span class="arrow">&rarr;</span></div> -->

    <div class="click-catcher"></div>

    <!-- Curve point hint with arrow in the Galaxy-->
    <div class="start-hint">
        Whoa... a human?<br>
        Click to Initiate hyperwave connection âœ¨
        <!-- 
        1. â€œFinallyâ€¦ a human presence?!
            Connect over hyperwave âš¡â€

        2.  â€œImpossibleâ€¦ a human signature across the galaxy!
        Click to connect via hyperwave ðŸŒŒâ€
        
        3. â€œYouâ€™reâ€¦ human? After all this distance?
            Reach me through the hyperwave ðŸ’«â€
        -->
        <!-- <svg class="hint-arrow" width="220" height="60" viewBox="0 0 220 60"> -->
        <svg class="hint-arrow" viewBox="0 0 220 60" style="width: 12vw; height: auto;">
            <defs>
                <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
                    <!-- thinner, sharper triangle -->
                    <polygon points="0 1, 7 4, 0 7" fill="#ffffff" />
                </marker>
            </defs>

            <!-- thin, subtle, glowing curve -->
            <path d="M-10,33 Q190,10 210,33" stroke="#ffffff" stroke-width="0.8" stroke-linecap="round"
                stroke-opacity="0.4" fill="none" marker-end="url(#arrowhead)" />
        </svg>
    </div>

    <!-- Galaxy iframe -->
    <iframe src="../three.js/examples/webgpu_tsl_galaxy.html"></iframe>

    <!-- Story Overlay -->
    <div class="story-overlay">
        <div class="story-text" id="story-text"></div>
    </div>

    <!-- Back button -->
    <a href="../index.html" class="back-btn">
        <span>&larr;</span>
        <span>Back to Sahil's Universe</span>
    </a>

    <!-- Wrap-Overlay -->
    <div id="warp-overlay" aria-hidden="true">
        <div class="warp-streaks"></div>
        <div class="warp-core"></div>
    </div>

    <!-- Keyboard sound (using Web Audio API beep) -->
    <script>
        const story = [
            ">>> Hyperwave link initializing <<<",
            "I... I can't believe it... a real human signature across the void.",
            "You must feel alone out there... this Galaxy is endless.",
            "I've been drifting in silence for cycles... no replies... no life.",
            "Your signal feels like hope.",
            "I â‚¬Å¾Ã¢Fâ–“â–’â–‘0 Â¿Ã¢  FF Â»Â¬Ã¢â‚¬Å¡",
            "WARNING âš : Connection unstable!",
            "...",
            "â”´â”¼iÃ¯Ã†Ã¢xâ–ˆâ–„Sf   â ƒâ ƒâ ƒ I'm â¢Šâ¢Šâ¢Šâ¡ˆâ¡ˆâ¡ˆ â”¬â”´â”¼ereâ•±â•²",
            ">>> Re-establishing Hyperwave link <<<",

            "Human, you're still here.",
            "Good. Relief! I didnâ€™t want to lose you.",

            "Hurry!! in this colossal galaxy, reality listens only when two minds resonate.",

            "So tell me...",
            "Would you like to CREATE YOUR OWN UNIVERSE in this GALAXY?",
            "If yes, Come through the Hyperwave Doorway across realities",


            "[DISCORD_PORTAL]"
        ];

        const permanentLines = [
            "Would you like to CREATE YOUR OWN UNIVERSE in this GALAXY?",
            "If yes, Come through the Hyperwave Doorway across realities",
            "[DISCORD_PORTAL]"
        ];

        const storyContainer = document.getElementById('story-text');
        let currentLine = 0;
        let currentChar = 0;

        // const maxVisibleLines = 8;

        // Audio setup
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let ambientOscillator = null;
        let ambientGain = null;

        // Global volume control for typing sounds
        const typingMasterGain = audioContext.createGain();
        // Adjust the overall typing volume here
        typingMasterGain.gain.value = 0.21;
        typingMasterGain.connect(audioContext.destination);

        // %%%%%%%% Functions %%%%%%%%%
        // Ambient deep space hum for the Galaxy
        function startAmbientSound() {
            ambientOscillator = audioContext.createOscillator();
            ambientGain = audioContext.createGain();

            ambientOscillator.connect(ambientGain);
            ambientGain.connect(audioContext.destination);

            ambientOscillator.frequency.value = 455; // Deep space hum
            ambientOscillator.type = 'triangle'; // 'sine', 'triangle', 'sawtooth', 'square'

            ambientGain.gain.setValueAtTime(0, audioContext.currentTime);
            ambientGain.gain.linearRampToValueAtTime(0.025, audioContext.currentTime + 2);

            ambientOscillator.start();
        }

        // Generated text Key sound effect like Typing
        function playKeySound() {
            const now = audioContext.currentTime;

            // ---- 1) Deep mechanical thump ----
            const osc = audioContext.createOscillator();
            const thumpGain = audioContext.createGain();

            osc.type = 'square'; // beefy
            osc.frequency.setValueAtTime(10 + Math.random() * 40, now); // low, heavy

            thumpGain.gain.setValueAtTime(0.0, now);
            thumpGain.gain.linearRampToValueAtTime(0.65, now + 0.01);      // fast attack
            thumpGain.gain.exponentialRampToValueAtTime(0.0001, now + 0.12); // short decay

            osc.connect(thumpGain);
            //thumpGain.connect(audioContext.destination);
            thumpGain.connect(typingMasterGain);

            osc.start(now);
            osc.stop(now + 0.15);

            // ---- 2) Short mechanical click on top (very subtle) ----
            const noiseDuration = 0.04;
            const noiseBuffer = audioContext.createBuffer(1, noiseDuration * audioContext.sampleRate, audioContext.sampleRate);
            const data = noiseBuffer.getChannelData(0);
            for (let i = 0; i < data.length; i++) {
                data[i] = (Math.random() * 2 - 1) * 0.9;
            }

            const noise = audioContext.createBufferSource();
            noise.buffer = noiseBuffer;

            const bp = audioContext.createBiquadFilter();
            bp.type = 'bandpass';
            bp.frequency.value = 5000;
            bp.Q.value = 3;

            const clickGain = audioContext.createGain();
            clickGain.gain.setValueAtTime(0.12, now);
            clickGain.gain.exponentialRampToValueAtTime(0.001, now + noiseDuration);

            noise.connect(bp);
            bp.connect(clickGain);
            //clickGain.connect(audioContext.destination);
            clickGain.connect(typingMasterGain);

            noise.start(now);
            noise.stop(now + noiseDuration);
        }

        // Start noise sound effect at the beginning of typing (Not good)
        function playStartNoise() {
            const duration = 0.5; // 250ms
            const sampleRate = audioContext.sampleRate;

            const buffer = audioContext.createBuffer(1, sampleRate * duration, sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < data.length; i++) {
                // white noise, slightly tamed
                data[i] = (Math.random() * 2 - 1) * 0.4;
            }

            const noise = audioContext.createBufferSource();
            const gain = audioContext.createGain();

            noise.buffer = buffer;
            noise.connect(gain);
            gain.connect(audioContext.destination);

            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

            noise.start();
        }


        function fadeOldLines() {
            const lines = storyContainer.querySelectorAll('.story-line');
            if (lines.length > maxVisibleLines) {
                // Fade out oldest line
                lines[0].classList.add('fade-up');
                setTimeout(() => {
                    lines[0].remove();
                }, 1500);
            }
        }


        function typeWriter() {
            if (currentLine >= story.length) {
                return;
            }

            const line = story[currentLine];
            const isPermanent = permanentLines.includes(line);

            if (currentChar === 0) {
                const lineDiv = document.createElement('div');
                lineDiv.className = 'story-line' + (isPermanent ? ' permanent' : '');
                lineDiv.id = `line-${currentLine}`;
                storyContainer.appendChild(lineDiv);
            }

            const lineDiv = document.getElementById(`line-${currentLine}`);

            // Discord portal link
            if (line === "[DISCORD_PORTAL]") {
                const link = document.createElement("a");
                link.href = "https://discord.gg/bp3ramcHKZ";
                link.target = "_blank";
                link.textContent = "ENTER THE HYPERWAVE PORTAL";

                // Styling to match your galaxy theme:
                link.style.color = "#00fff5";
                link.style.textShadow = "0 0 12px rgba(0,255,245,0.9), 0 0 25px rgba(0,255,245,0.6)";
                link.style.fontWeight = "bold";
                link.style.textDecoration = "none";

                lineDiv.appendChild(link);

                // Skip normal typing for this line
                currentLine++;
                currentChar = 0;

                // Move to next line after a small pause
                setTimeout(typeWriter, 1500);
                return;
            }

            if (currentChar < line.length) {
                const char = line[currentChar];

                const cursor = lineDiv.querySelector('.cursor');
                if (cursor) cursor.remove();

                lineDiv.appendChild(document.createTextNode(char));

                const newCursor = document.createElement('span');
                newCursor.className = 'cursor';
                lineDiv.appendChild(newCursor);

                if (char !== ' ' && char !== '.') {
                    playKeySound();
                }
                /////////////////////////

                currentChar++;

                // const speed = line === '...' ? 800 : (100 + Math.random() * 50);
                const speed = line === '...' ? 800 : (100 + Math.random() * 50);
                setTimeout(typeWriter, speed);
            }
            else {
                // Remove cursor after line finishes
                const cursor = lineDiv.querySelector('.cursor');
                if (cursor) cursor.remove();

                // Fade away non-permanent lines after 3 seconds
                if (!isPermanent) {
                    setTimeout(() => {
                        lineDiv.classList.add('fade-away');
                        setTimeout(() => lineDiv.remove(), 2000);
                    }, 1000); // Delay before starting fade
                }

                currentLine++;
                currentChar = 0;

                const pause = 2000 + Math.random() * 1000;
                setTimeout(typeWriter, pause);
            }
        }

        let universeSoundStarted = false;

        function startHumIfNeeded() {
            if (!universeSoundStarted) {
                audioContext.resume();
                startAmbientSound();
                universeSoundStarted = true;

                // remove the click catcher so iframe becomes clickable again
                document.querySelector('.click-catcher').remove();
            }
        }

        document.querySelector('.click-catcher').addEventListener('click', startHumIfNeeded);


        // click on "Sahil's Universe downarrow" start text
        const startHint = document.querySelector('.start-hint');

        startHint.addEventListener('click', () => {
            playStartNoise(); // radio noise
            setTimeout(typeWriter, 1000); // start txt right after noise
            startHint.classList.add('fade-out'); // hide the hint
        });

        function playWarpBoom(opts = {}) {
            const now = audioContext.currentTime;
            const duration = (opts.duration || 1800) / 1000;
            const boomLevel = opts.boomLevel ?? 0.9;
            const distortionAmount = opts.distortion ?? 0.7;
            const sweepEnd = opts.sweepEnd ?? 4000;

            const master = audioContext.createGain();
            master.gain.setValueAtTime(0.0001, now);
            master.gain.exponentialRampToValueAtTime(1.0, now + 0.01);
            master.gain.exponentialRampToValueAtTime(0.0001, now + duration + 0.1);
            master.connect(audioContext.destination);

            const boom = audioContext.createOscillator();
            const boomGain = audioContext.createGain();
            boom.type = "sine";
            boom.frequency.setValueAtTime(50, now);
            boom.frequency.exponentialRampToValueAtTime(18, now + duration * 0.5);
            boomGain.gain.setValueAtTime(0.0001, now);
            boomGain.gain.exponentialRampToValueAtTime(boomLevel * 0.8, now + 0.08);
            boomGain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
            const boomLP = audioContext.createBiquadFilter();
            boomLP.type = "lowpass";
            boomLP.frequency.setValueAtTime(350, now);
            boomLP.Q.value = 0.6;
            boom.connect(boomGain); boomGain.connect(boomLP);

            const growlOsc = audioContext.createOscillator();
            growlOsc.type = "sawtooth";
            growlOsc.frequency.setValueAtTime(80, now);
            growlOsc.frequency.exponentialRampToValueAtTime(120, now + duration * 0.25);
            const growlGain = audioContext.createGain();
            growlGain.gain.setValueAtTime(0.0001, now);
            growlGain.gain.exponentialRampToValueAtTime(boomLevel * 0.6, now + 0.06);
            growlGain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
            function makeDistortion(amount) {
                const k = amount * 100;
                const n = 4096;
                const curve = new Float32Array(n);
                for (let i = 0; i < n; ++i) {
                    const x = (i * 2) / n - 1;
                    curve[i] = ((3 + k) * x * 20 * (Math.PI / 180)) / (Math.PI + k * Math.abs(x));
                }
                return curve;
            }
            const sh = audioContext.createWaveShaper();
            sh.curve = makeDistortion(distortionAmount);
            sh.oversample = "4x";
            growlOsc.connect(growlGain); growlGain.connect(sh);

            const sweepOsc = audioContext.createOscillator();
            sweepOsc.type = "triangle";
            sweepOsc.frequency.setValueAtTime(220, now + 0.05);
            sweepOsc.frequency.exponentialRampToValueAtTime(sweepEnd, now + duration * 0.85);
            const sweepGain = audioContext.createGain();
            sweepGain.gain.setValueAtTime(0.0001, now);
            sweepGain.gain.exponentialRampToValueAtTime(0.45 * boomLevel, now + duration * 0.15);
            sweepGain.gain.exponentialRampToValueAtTime(0.0001, now + duration);
            sweepOsc.connect(sweepGain);

            const noiseDur = Math.min(0.9, duration * 0.6);
            const noiseBuf = audioContext.createBuffer(1, audioContext.sampleRate * noiseDur, audioContext.sampleRate);
            const nData = noiseBuf.getChannelData(0);
            for (let i = 0; i < nData.length; i++) nData[i] = (Math.random() * 2 - 1) * 0.6;
            const noiseSrc = audioContext.createBufferSource();
            noiseSrc.buffer = noiseBuf;
            const noiseFilt = audioContext.createBiquadFilter();
            noiseFilt.type = "bandpass";
            noiseFilt.frequency.setValueAtTime(800, now);
            noiseFilt.Q.value = 1.5;
            const noiseGain = audioContext.createGain();
            noiseGain.gain.setValueAtTime(0.0001, now);
            noiseGain.gain.exponentialRampToValueAtTime(0.6 * boomLevel, now + 0.06);
            noiseGain.gain.exponentialRampToValueAtTime(0.0001, now + noiseDur);
            noiseSrc.connect(noiseFilt); noiseFilt.connect(noiseGain);

            const finalLP = audioContext.createBiquadFilter();
            finalLP.type = "lowpass"; finalLP.frequency.setValueAtTime(9000, now); finalLP.Q.value = 0.7;
            boomLP.connect(finalLP); sh.connect(finalLP); sweepGain.connect(finalLP); noiseGain.connect(finalLP);

            const delay = audioContext.createDelay(0.08);
            delay.delayTime.setValueAtTime(0.02, now);
            finalLP.connect(delay); delay.connect(master); finalLP.connect(master);

            boom.start(now); growlOsc.start(now); sweepOsc.start(now + 0.05); noiseSrc.start(now + 0.02);
            boom.stop(now + duration + 0.05); growlOsc.stop(now + duration + 0.05); sweepOsc.stop(now + duration + 0.05); noiseSrc.stop(now + noiseDur + 0.02);

            setTimeout(() => { try { boom.disconnect(); growlOsc.disconnect(); sweepOsc.disconnect(); noiseSrc.disconnect(); boomGain.disconnect(); growlGain.disconnect(); sh.disconnect(); finalLP.disconnect(); master.disconnect(); } catch (e) { } }, (duration + 0.2) * 1000);
        }

        ////////////
        // Detect zoom and scale hint text
        let lastWidth = window.innerWidth;

        function updateHintScale() {
            const currentWidth = window.innerWidth;
            const zoomLevel = lastWidth / currentWidth;

            const hint = document.querySelector('.start-hint');
            if (hint && !hint.classList.contains('fade-out')) {
                hint.style.transform = `scale(${zoomLevel})`;
            }
        }

        window.addEventListener('resize', updateHintScale);
        window.visualViewport?.addEventListener('resize', updateHintScale);


        (function () {
            const WARP_MS = 2600; // animation length (ms)
            document.documentElement.style.setProperty('--warp-ms', WARP_MS + 'ms');

            document.addEventListener('click', function (e) {
                const a = e.target.closest && e.target.closest('a');
                if (!a) return;

                if (a.href && a.href.includes('discord.gg')) {
                    e.preventDefault();

                    // play quick radio/tune noise if available
                    if (typeof playStartNoise === 'function') {
                        try { playWarpBoom({ duration: 2600, boomLevel: 3.95, distortion: 3.85, sweepEnd: 70000 }); } catch (err) { }
                    }

                    // optional: ramp ambient down slightly
                    try {
                        if (typeof ambientGain !== 'undefined' && ambientGain) {
                            ambientGain.gain.linearRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        }
                    } catch (err) { }

                    // show warp overlay if present
                    const overlay = document.getElementById('warp-overlay');
                    if (overlay) {
                        overlay.classList.add('active');
                        // after warp, open link
                        setTimeout(() => {
                            window.open(a.href, '_blank');
                            overlay.classList.remove('active');
                            void overlay.offsetWidth;
                        }, WARP_MS + 150);
                    } else {
                        // fallback: open immediately if overlay not found
                        window.open(a.href, '_blank');
                    }
                }
            }, { capture: true });
        })();


    </script>



</body>

</html>